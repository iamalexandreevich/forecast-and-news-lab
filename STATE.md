# STATE.md - –î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

_–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: 2025-09-29_

## üìã –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ
1. [–û–±–∑–æ—Ä –ø—Ä–æ–µ–∫—Ç–∞](#–æ–±–∑–æ—Ä-–ø—Ä–æ–µ–∫—Ç–∞)
2. [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞-—Å–∏—Å—Ç–µ–º—ã)
3. [–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤](#—Å—Ç—Ä—É–∫—Ç—É—Ä–∞-—Ñ–∞–π–ª–æ–≤)
4. [–ú–æ–¥—É–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞](#–º–æ–¥—É–ª—å–Ω–∞—è-—Å–∏—Å—Ç–µ–º–∞)
5. [–ü–æ—Ç–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è](#–ø–æ—Ç–æ–∫-–≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è)
6. [–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞](#–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è-–∏-–Ω–∞—Å—Ç—Ä–æ–π–∫–∞)
7. [API –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏](#api-–∏-–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏)
8. [–¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫](#—Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π-—Å—Ç–µ–∫)
9. [–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –∑–∞–ø—É—Å–∫—É](#–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏-–ø–æ-–∑–∞–ø—É—Å–∫—É)
10. [–ò–∑–≤–µ—Å—Ç–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è](#–∏–∑–≤–µ—Å—Ç–Ω—ã–µ-–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è)

---

## üéØ –û–±–∑–æ—Ä –ø—Ä–æ–µ–∫—Ç–∞

**–ù–∞–∑–≤–∞–Ω–∏–µ**: –°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏—è –∞–∫—Ü–∏–π —Å –∞–Ω–∞–ª–∏–∑–æ–º –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–π
**–¢–∏–ø**: Streamlit –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
**–¶–µ–ª—å**: –ö–æ–º–ø–ª–µ–∫—Å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –∏ –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–≤–∏–∂–µ–Ω–∏—è –∞–∫—Ü–∏–π –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö, –Ω–æ–≤–æ—Å—Ç–µ–π –∏–∑ Telegram –∏ LLM-–∞–Ω–∞–ª–∏–∑–∞ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–π

### –ö–ª—é—á–µ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:
- üìä –ê–Ω–∞–ª–∏–∑ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö –∞–∫—Ü–∏–π —Å Yahoo Finance –∏ MOEX
- üì± –ü–∞—Ä—Å–∏–Ω–≥ Telegram –∫–∞–Ω–∞–ª–æ–≤ –¥–ª—è —Å–±–æ—Ä–∞ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –Ω–æ–≤–æ—Å—Ç–µ–π
- ü§ñ LLM-–∞–Ω–∞–ª–∏–∑ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–π –Ω–æ–≤–æ—Å—Ç–µ–π —á–µ—Ä–µ–∑ OpenAI API
- üìà ML-–ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏–µ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º RandomForest
- üìâ –ö–æ—Ä—Ä–µ–ª—è—Ü–∏–æ–Ω–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –Ω–æ–≤–æ—Å—Ç–µ–π –∏ –¥–≤–∏–∂–µ–Ω–∏—è –∞–∫—Ü–∏–π
- üé® –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ Plotly

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–∏—Å—Ç–µ–º—ã

### –ú–æ–¥—É–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ    app.py       ‚îÇ ‚Üê –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ Streamlit
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
    ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇ modules ‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ
         ‚îú‚îÄ‚îÄ stock_analyzer.py    ‚Üí –ó–∞–≥—Ä—É–∑–∫–∞ –∏ –∞–Ω–∞–ª–∏–∑ –±–∏—Ä–∂–µ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
         ‚îú‚îÄ‚îÄ telegram_parser.py   ‚Üí –ü–∞—Ä—Å–∏–Ω–≥ Telegram –∫–∞–Ω–∞–ª–æ–≤
         ‚îú‚îÄ‚îÄ llm_analyzer.py      ‚Üí LLM –∞–Ω–∞–ª–∏–∑ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–π
         ‚îú‚îÄ‚îÄ forecaster.py        ‚Üí ML –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏–µ
         ‚îî‚îÄ‚îÄ visualizer.py        ‚Üí –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
```

### –ü–æ—Ç–æ–∫ –¥–∞–Ω–Ω—ã—Ö
```
[Yahoo/MOEX API] ‚Üí [StockAnalyzer] ‚Üí [–ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ]
                                           ‚Üì
[Telegram API] ‚Üí [TelegramParser] ‚Üí [–ù–æ–≤–æ—Å—Ç–∏] ‚Üí [LLMAnalyzer] ‚Üí [–ù–∞—Å—Ç—Ä–æ–µ–Ω–∏—è]
                                           ‚Üì
                                    [Forecaster] ‚Üí [–ü—Ä–æ–≥–Ω–æ–∑]
                                           ‚Üì
                                    [Visualizer] ‚Üí [UI]
```

---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ñ–∞–π–ª–æ–≤

```
–ò–ò –≠–ö–°–ü–ï–†–¢–ù–´–ï –°–ò–°–¢–ï–ú–´/
‚îÇ
‚îú‚îÄ‚îÄ app.py                    # –ì–ª–∞–≤–Ω—ã–π —Ñ–∞–π–ª –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è Streamlit
‚îú‚îÄ‚îÄ STATE.md                  # –≠—Ç–æ—Ç —Ñ–∞–π–ª - –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞
‚îú‚îÄ‚îÄ replit.md                 # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–ª—è Replit
‚îú‚îÄ‚îÄ pyproject.toml            # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–æ–µ–∫—Ç–∞ –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ uv.lock                   # Lock-—Ñ–∞–π–ª –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
‚îÇ
‚îú‚îÄ‚îÄ config/                   # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ channels.yml          # –°–ø–∏—Å–æ–∫ Telegram-–∫–∞–Ω–∞–ª–æ–≤
‚îÇ   ‚îî‚îÄ‚îÄ keywords.yml          # –ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –∏ —Ñ—Ä–∞–∑—ã
‚îÇ
‚îú‚îÄ‚îÄ modules/                  # –û—Å–Ω–æ–≤–Ω—ã–µ –º–æ–¥—É–ª–∏ —Å–∏—Å—Ç–µ–º—ã
‚îÇ   ‚îú‚îÄ‚îÄ __init__.py          # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø–∞–∫–µ—Ç–∞
‚îÇ   ‚îú‚îÄ‚îÄ stock_analyzer.py    # –ê–Ω–∞–ª–∏–∑ –±–∏—Ä–∂–µ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îú‚îÄ‚îÄ schemas.py           # Pydantic-—Å—Ö–µ–º—ã –¥–ª—è –∫–æ–Ω—Ñ–∏–≥–æ–≤ –∏ —Å–æ–æ–±—â–µ–Ω–∏–π
‚îÇ   ‚îú‚îÄ‚îÄ storage.py           # –†–∞–±–æ—Ç–∞ —Å Parquet-—Ö—Ä–∞–Ω–∏–ª–∏—â–µ–º
‚îÇ   ‚îú‚îÄ‚îÄ telegram_parser.py   # –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∫–æ–Ω–≤–µ–π–µ—Ä Telegram
‚îÇ   ‚îú‚îÄ‚îÄ llm_analyzer.py      # LLM –∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä
‚îÇ   ‚îú‚îÄ‚îÄ forecaster.py        # –ü—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏–µ
‚îÇ   ‚îî‚îÄ‚îÄ visualizer.py        # –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è
‚îÇ
‚îú‚îÄ‚îÄ tests/                   # –ú–æ–¥—É–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã
‚îÇ   ‚îî‚îÄ‚îÄ test_telegram_parser.py
‚îÇ
‚îú‚îÄ‚îÄ .venv/                   # –í–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ Python
‚îî‚îÄ‚îÄ __pycache__/             # –°–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ Python —Ñ–∞–π–ª—ã
```

---

## üîß –ú–æ–¥—É–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞

### 1. StockAnalyzer (`modules/stock_analyzer.py`)
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ó–∞–≥—Ä—É–∑–∫–∞ –∏ –∞–Ω–∞–ª–∏–∑ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö –∞–∫—Ü–∏–π

#### –ö–ª–∞—Å—Å: `StockAnalyzer`

**–ú–µ—Ç–æ–¥—ã**:
- `__init__()`: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å –ø—É—Å—Ç—ã–º —Å–ª–æ–≤–∞—Ä–µ–º –¥–∞–Ω–Ω—ã—Ö
- `fetch_stock_data(symbols, period="2y")`: –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Å–ø–∏—Å–∫–∞ —Å–∏–º–≤–æ–ª–æ–≤
  - –°–Ω–∞—á–∞–ª–∞ –ø—ã—Ç–∞–µ—Ç—Å—è Yahoo Finance
  - –ü—Ä–∏ –Ω–µ—É–¥–∞—á–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç MOEX ISS API –¥–ª—è —Ä–æ—Å—Å–∏–π—Å–∫–∏—Ö –∞–∫—Ü–∏–π
- `_fetch_from_yahoo(symbol, period)`: –ó–∞–≥—Ä—É–∑–∫–∞ —á–µ—Ä–µ–∑ yfinance
- `_fetch_from_moex(symbol, period)`: –†–µ–∑–µ—Ä–≤–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —Å MOEX
  - –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ø–∞–≥–∏–Ω–∞—Ü–∏—é (–¥–æ 50 —Å—Ç—Ä–∞–Ω–∏—Ü)
  - –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ —Ñ–æ—Ä–º–∞—Ç —Å–æ–≤–º–µ—Å—Ç–∏–º—ã–π —Å Yahoo
- `_normalize_moex_symbol(symbol)`: –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è —Å–∏–º–≤–æ–ª–æ–≤ –¥–ª—è MOEX
- `calculate_price_changes(symbol)`: –†–∞—Å—á–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π —Ü–µ–Ω—ã (1–¥, 7–¥, 30–¥)
- `find_top_movements(symbol, top_n=20)`: –ü–æ–∏—Å–∫ —Ç–æ–ø –¥–≤–∏–∂–µ–Ω–∏–π —Ü–µ–Ω—ã
- `calculate_statistics(symbol)`: –†–∞—Å—á–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ (—Å—Ä–µ–¥–Ω–µ–µ, –º–µ–¥–∏–∞–Ω–∞, std)
- `identify_patterns_before_movements(symbol, days_before=5)`: –ê–Ω–∞–ª–∏–∑ –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤
- `get_recent_data(symbol, days=30)`: –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –¥–∞–Ω–Ω—ã—Ö

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**:
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –º–µ–∂–¥—É Yahoo Finance –∏ MOEX
- –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤ `self.stock_data`
- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–º–∏ —Å–æ–æ–±—â–µ–Ω–∏—è–º–∏

---

### 2. Telegram Parser (`modules/telegram_parser.py`)
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ù–∞–¥—ë–∂–Ω—ã–π –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∫–æ–Ω–≤–µ–π–µ—Ä –ø–∞—Ä—Å–∏–Ω–≥–∞ –ø—É–±–ª–∏—á–Ω—ã—Ö Telegram-–∫–∞–Ω–∞–ª–æ–≤ —Å –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω—ã–º–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è–º–∏.

#### –ö–ª—é—á–µ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
- `initialize_client(api_id, api_hash, phone)` ‚Äî –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç Telethon user-—Å–µ—Å—Å–∏—é –≤ `data/telegram/stock_forecasting_session.session`.
- `fetch_channel_messages(client, channel, since_id, since_days)` ‚Äî –¥–æ–≥—Ä—É–∂–∞–µ—Ç –Ω–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è, –Ω–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç –¥–∞—Ç—É –≤ UTC –∏ –∏–∑–≤–ª–µ–∫–∞–µ—Ç —Å—Å—ã–ª–∫–∏/—Ç–∏–∫–µ—Ä—ã/—Ö—ç—à—Ç–µ–≥–∏.
- `parse_channels(channel_cfgs, stock_symbols, days_back, ...)` ‚Äî –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∫–∞–Ω–∞–ª—ã, –≤—ã–¥–µ—Ä–∂–∏–≤–∞–µ—Ç `FloodWait`, –æ–±–Ω–æ–≤–ª—è–µ—Ç watermark `data/telegram/state.json` –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã.
- `filter_messages(df, stock_symbols, keywords)` ‚Äî –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ —Ç–∏–∫–µ—Ä–∞–º –∏ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º.
- `run_telegram_parser(...)` ‚Äî —Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –æ–±–æ–ª–æ—á–∫–∞ –¥–ª—è Streamlit/CLI, –≤–æ–∑–≤—Ä–∞—â–∞—é—â–∞—è –≥–æ—Ç–æ–≤—ã–π `pandas.DataFrame`.

#### –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏
- –†–∞–±–æ—Ç–∞ —Ç–æ–ª—å–∫–æ —Å –ø—É–±–ª–∏—á–Ω—ã–º–∏ –∫–∞–Ω–∞–ª–∞–º–∏; –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ Telethon –ø–æ–¥ user-–∞–∫–∫–∞—É–Ω—Ç.
- –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–æ—Å—Ç—å –∏ –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è —Å–æ–æ–±—â–µ–Ω–∏–π –ø–æ `msg_hash` (sha256).
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å—ã—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤ `data/telegram/raw/{YYYY-MM-DD}.parquet` –∏ –∞–≥—Ä–µ–≥–∞—Ç–∞ `data/telegram/latest.parquet`.
- –ú—è–≥–∫–æ–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–æ—Å–ª–µ `FloodWaitError`, `UsernameInvalidError`, `ChannelPrivateError`.
- –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º–∞—è –∫–æ–Ω–∫—É—Ä—Ä–µ–Ω—Ç–Ω–æ—Å—Ç—å (`max_concurrency`) –∏ —Ñ–∏–ª—å—Ç—Ä—ã –ø–æ allow-–ª–∏—Å—Ç—É —Ç–∏–∫–µ—Ä–æ–≤ –∏ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º.

#### –°–æ–ø—É—Ç—Å—Ç–≤—É—é—â–∏–µ –º–æ–¥—É–ª–∏
- `modules/schemas.py` ‚Äî Pydantic-–º–æ–¥–µ–ª–∏ `ChannelConfig`, `TelegramMessage` –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∫–æ–Ω—Ñ–∏–≥–æ–≤ –∏ –¥–∞–Ω–Ω—ã—Ö.
- `modules/storage.py` ‚Äî –æ–±—ë—Ä—Ç–∫–∏ `save_parquet`/`load_parquet` —Å –≥–∞—Ä–∞–Ω—Ç–∏–µ–π —Å–æ–∑–¥–∞–Ω–∏—è –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π.

---

### 3. LLMAnalyzer (`modules/llm_analyzer.py`)
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ê–Ω–∞–ª–∏–∑ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–π —á–µ—Ä–µ–∑ LLM

#### –ö–ª–∞—Å—Å: `LLMAnalyzer`

**–ú–µ—Ç–æ–¥—ã**:
- `__init__(api_key, base_url, model_name)`:
  - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∫–∞—Å—Ç–æ–º–Ω—ã—Ö OpenAI-—Å–æ–≤–º–µ—Å—Ç–∏–º—ã—Ö endpoints
  - –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –º–æ–¥–µ–ª—å "gpt-5"
- `analyze_news_sentiment(text, stock_symbol=None)`:
  - –ê–Ω–∞–ª–∏–∑ –æ–¥–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–∞
  - –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç JSON —Å sentiment, confidence, stock_impact
- `analyze_batch_messages(messages_df, stock_symbols)`:
  - –ü–∞–∫–µ—Ç–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –º–Ω–æ–∂–µ—Å—Ç–≤–∞ —Å–æ–æ–±—â–µ–Ω–∏–π
  - Progress bar –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è
- `correlate_news_with_stock_movements(news_df, stock_data, symbol)`:
  - –ö–æ—Ä—Ä–µ–ª—è—Ü–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–π —Å –¥–≤–∏–∂–µ–Ω–∏–µ–º —Ü–µ–Ω
  - –†–∞—Å—á–µ—Ç –ª–∞–≥–æ–≤—ã—Ö –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–π (–¥–æ 7 –¥–Ω–µ–π)
- `generate_forecast_analysis(historical_patterns, news_sentiment, symbol)`:
  - –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –ø—Ä–æ–≥–Ω–æ–∑–∞ –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–∞–Ω–Ω—ã—Ö
  - –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π JSON –æ—Ç–≤–µ—Ç

**–§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ LLM**:
```json
{
  "sentiment": "positive|negative|neutral",
  "confidence": 0.0-1.0,
  "stock_impact": "bullish|bearish|neutral",
  "impact_strength": 1-10,
  "key_factors": ["factor1", "factor2"],
  "summary": "–∫—Ä–∞—Ç–∫–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ"
}
```

---

### 4. StockForecaster (`modules/forecaster.py`)
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: ML –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏–µ —Å RandomForest

#### –ö–ª–∞—Å—Å: `StockForecaster`

**–ú–µ—Ç–æ–¥—ã**:
- `__init__()`: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–æ–¥–µ–ª–∏ –∏ scaler
- `prepare_features(stock_data, sentiment_data=None)`:
  - –ò–Ω–∂–µ–Ω–µ—Ä–∏–Ω–≥ –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ (SMA, RSI, volatility)
  - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è sentiment –¥–∞–Ω–Ω—ã—Ö –µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω—ã
- `calculate_rsi(prices, window=14)`: –†–∞—Å—á–µ—Ç RSI –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞
- `aggregate_daily_sentiment(sentiment_data)`:
  - –ê–≥—Ä–µ–≥–∞—Ü–∏—è sentiment –ø–æ –¥–Ω—è–º
  - –†–∞—Å—á–µ—Ç —Å—Ä–µ–¥–Ω–∏—Ö –∑–Ω–∞—á–µ–Ω–∏–π –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞
- `merge_sentiment_data(stock_data, sentiment_data)`:
  - –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –±–∏—Ä–∂–µ–≤—ã—Ö –∏ sentiment –¥–∞–Ω–Ω—ã—Ö
  - –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ª–∞–≥–æ–≤—ã—Ö –ø—Ä–∏–∑–Ω–∞–∫–æ–≤
- `train_model(prepared_data)`:
  - –û–±—É—á–µ–Ω–∏–µ RandomForestRegressor
  - 80/20 train/test split
  - –†–∞—Å—á–µ—Ç –º–µ—Ç—Ä–∏–∫ (MSE, R¬≤)
- `generate_forecast(recent_data, days_ahead=90)`:
  - –ò—Ç–µ—Ä–∞—Ç–∏–≤–Ω–æ–µ –ø—Ä–æ–≥–Ω–æ–∑–∏—Ä–æ–≤–∞–Ω–∏–µ
  - –î–æ–±–∞–≤–ª–µ–Ω–∏–µ confidence bands
- `get_feature_importance()`: –í–∞–∂–Ω–æ—Å—Ç—å –ø—Ä–∏–∑–Ω–∞–∫–æ–≤ –º–æ–¥–µ–ª–∏

**–ü—Ä–∏–∑–Ω–∞–∫–∏ –º–æ–¥–µ–ª–∏**:
- –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã: SMA_5, SMA_20, RSI
- –ò–∑–º–µ–Ω–µ–Ω–∏—è —Ü–µ–Ω: 1–¥, 5–¥, 20–¥
- –û–±—ä–µ–º—ã: Volume_SMA_5, Volume_Ratio
- –í–æ–ª–∞—Ç–∏–ª—å–Ω–æ—Å—Ç—å: 5–¥, 20–¥
- High-Low spread
- Sentiment –º–µ—Ç—Ä–∏–∫–∏ (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω—ã)

---

### 5. Visualizer (`modules/visualizer.py`)
**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

#### –ö–ª–∞—Å—Å: `Visualizer`

**–ú–µ—Ç–æ–¥—ã**:
- `__init__()`: –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ü–≤–µ—Ç–æ–≤–æ–π –ø–∞–ª–∏—Ç—Ä—ã
- `plot_stock_price_history(stock_data, symbol)`:
  - –ì—Ä–∞—Ñ–∏–∫ —Ü–µ–Ω—ã –∏ –æ–±—ä–µ–º–∞ (2 –ø–æ–¥–≥—Ä–∞—Ñ–∏–∫–∞)
- `plot_price_distribution(stock_data, symbol)`:
  - –ì–∏—Å—Ç–æ–≥—Ä–∞–º–º–∞ –∏ box plot —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è
- `plot_top_movements(top_rises, top_falls, symbol)`:
  - –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Ç–æ–ø –¥–≤–∏–∂–µ–Ω–∏–π —Ü–µ–Ω—ã
- `plot_sentiment_analysis(sentiment_df)`:
  - Pie chart –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–π
  - Timeline –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–π
  - Heatmap —Å–∏–ª—ã –≤–æ–∑–¥–µ–π—Å—Ç–≤–∏—è
- `plot_correlation_analysis(correlation_df)`:
  - –ö–æ—Ä—Ä–µ–ª—è—Ü–∏–æ–Ω–Ω–∞—è –º–∞—Ç—Ä–∏—Ü–∞
  - –ì—Ä–∞—Ñ–∏–∫ –ª–∞–≥–æ–≤—ã—Ö –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–π
- `plot_forecast(historical_data, forecast_data, symbol)`:
  - –ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–µ –¥–∞–Ω–Ω—ã–µ + –ø—Ä–æ–≥–Ω–æ–∑
  - Confidence bands
- `display_statistics_table(stats_dict, symbol)`:
  - –¢–∞–±–ª–∏—Ü–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –≤ Streamlit

**–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞**: Plotly –¥–ª—è –≤—Å–µ—Ö –≥—Ä–∞—Ñ–∏–∫–æ–≤
**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**:
- –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ –≥—Ä–∞—Ñ–∏–∫–∏
- –ê–¥–∞–ø—Ç–∏–≤–Ω–∞—è –∫–æ–º–ø–æ–Ω–æ–≤–∫–∞
- –ö–∞—Å—Ç–æ–º–Ω–∞—è —Ü–≤–µ—Ç–æ–≤–∞—è —Å—Ö–µ–º–∞

---

## üîÑ –ü–æ—Ç–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

### 1. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è (`app.py`)
```python
1. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Streamlit —Å—Ç—Ä–∞–Ω–∏—Ü—ã
2. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è session_state —Å –¥–µ—Ñ–æ–ª—Ç–Ω—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏
3. –°–æ–∑–¥–∞–Ω–∏–µ sidebar —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
4. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–µ—Ä–≤–∏—Å–æ–≤ (StockAnalyzer, LLMAnalyzer, etc.)
```

### 2. –í–∫–ª–∞–¥–∫–∏ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞

#### –í–∫–ª–∞–¥–∫–∞ "–ê–Ω–∞–ª–∏–∑ –∞–∫—Ü–∏–π":
```python
1. fetch_stock_data() –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö —Å–∏–º–≤–æ–ª–æ–≤
2. calculate_price_changes() –∏ calculate_statistics()
3. find_top_movements() –¥–ª—è –∫–∞–∂–¥–æ–π –∞–∫—Ü–∏–∏
4. –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ Visualizer –º–µ—Ç–æ–¥—ã
```

#### –í–∫–ª–∞–¥–∫–∞ "–ù–∞—Å—Ç—Ä–æ–µ–Ω–∏—è –Ω–æ–≤–æ—Å—Ç–µ–π":
```python
1. run_telegram_parser() —Å API credentials
2. filter_stock_related_messages()
3. analyze_batch_messages() —á–µ—Ä–µ–∑ LLM
4. –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∞–Ω–∞–ª–∏–∑–∞
```

#### –í–∫–ª–∞–¥–∫–∞ "–ö–æ—Ä—Ä–µ–ª—è—Ü–∏—è":
```python
1. –ó–∞–≥—Ä—É–∑–∫–∞ sentiment –∏ stock –¥–∞–Ω–Ω—ã—Ö
2. correlate_news_with_stock_movements()
3. –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –∫–æ—Ä—Ä–µ–ª—è—Ü–∏–æ–Ω–Ω—ã—Ö –º–∞—Ç—Ä–∏—Ü
4. –†–∞—Å—á–µ—Ç –ª–∞–≥–æ–≤—ã—Ö —ç—Ñ—Ñ–µ–∫—Ç–æ–≤
```

#### –í–∫–ª–∞–¥–∫–∞ "–ü—Ä–æ–≥–Ω–æ–∑":
```python
1. prepare_features() —Å –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏
2. train_model() –Ω–∞ –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–Ω—ã—Ö –ø—Ä–∏–∑–Ω–∞–∫–∞—Ö
3. generate_forecast() –Ω–∞ 90 –¥–Ω–µ–π –≤–ø–µ—Ä–µ–¥
4. –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ–≥–Ω–æ–∑–∞ —Å confidence bands
```

#### –í–∫–ª–∞–¥–∫–∞ "–û—Ç—á–µ—Ç":
```python
1. –ê–≥—Ä–µ–≥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –∏–∑ –≤—Å–µ—Ö –≤–∫–ª–∞–¥–æ–∫
2. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å–≤–æ–¥–Ω–æ–≥–æ –æ—Ç—á–µ—Ç–∞
3. –≠–∫—Å–ø–æ—Ä—Ç –≤ JSON —Ñ–æ—Ä–º–∞—Ç
4. –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–ª—é—á–µ–≤—ã—Ö –º–µ—Ç—Ä–∏–∫
```

---

## ‚öôÔ∏è –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
```bash
# OpenAI/LLM –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
OPENAI_API_KEY=your_api_key
OPENAI_BASE_URL=https://api.openai.com/v1
OPENAI_MODEL_NAME=gpt-5

# Telegram –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
TELEGRAM_API_ID=your_api_id
TELEGRAM_API_HASH=your_api_hash
TELEGRAM_PHONE=your_phone
```

### –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ UI (sidebar)
- **–°–∏–º–≤–æ–ª—ã –∞–∫—Ü–∏–π**: Multiselect + custom input
- **Telegram –∫–∞–Ω–∞–ª—ã**: –¢–µ–∫—Å—Ç–æ–≤–æ–µ –ø–æ–ª–µ (–ø–æ –æ–¥–Ω–æ–º—É –Ω–∞ —Å—Ç—Ä–æ–∫—É)
- **–ü–µ—Ä–∏–æ–¥ –∞–Ω–∞–ª–∏–∑–∞**: 1y, 2y, 5y
- **–î–Ω–∏ –Ω–æ–≤–æ—Å—Ç–µ–π**: Slider 1-30 –¥–Ω–µ–π
- **API –Ω–∞—Å—Ç—Ä–æ–π–∫–∏**: –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ session_state

### –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (`pyproject.toml`)
```toml
[project]
name = "repl-nix-workspace"
version = "0.1.0"
requires-python = ">=3.11"
dependencies = [
    "numpy>=2.3.3",
    "openai>=1.109.1",
    "pandas>=2.3.2",
    "pydantic>=2.0.0",
    "pyyaml>=6.0.2",
    "pytest>=8.3.4",
    "pytest-asyncio>=0.25.2",
    "plotly>=6.3.0",
    "scikit-learn>=1.7.2",
    "scipy>=1.16.2",
    "streamlit>=1.50.0",
    "telethon>=1.41.2",
    "yfinance>=0.2.66",
]
```

---

## üåê API –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏

### 1. Yahoo Finance API
- **–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞**: yfinance
- **Endpoint**: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —á–µ—Ä–µ–∑ –±–∏–±–ª–∏–æ—Ç–µ–∫—É
- **–î–∞–Ω–Ω—ã–µ**: OHLCV, –¥–∏–≤–∏–¥–µ–Ω–¥—ã, —Å–ø–ª–∏—Ç—ã
- **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è**: –ù–µ–∫–æ—Ç–æ—Ä—ã–µ —Ä–æ—Å—Å–∏–π—Å–∫–∏–µ –∞–∫—Ü–∏–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã

### 2. MOEX ISS API
- **Endpoint**: `https://iss.moex.com/iss/engines/stock/markets/shares/boards/{board}/securities/{symbol}/candles.json`
- **–§–æ—Ä–º–∞—Ç**: JSON
- **–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**:
  - –ü—É–±–ª–∏—á–Ω—ã–π API –±–µ–∑ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
  - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –ø–∞–≥–∏–Ω–∞—Ü–∏–∏
  - –ò–Ω—Ç–µ—Ä–≤–∞–ª—ã: 1, 10, 60, 24 (—á–∞—Å—ã)

### 3. Telegram API
- **–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞**: Telethon
- **–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è**: API ID + Hash + Phone
- **–°–µ—Å—Å–∏—è**: –°–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ `stock_forecasting_session`
- **Rate limits**: –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ Telegram –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

### 4. OpenAI API
- **–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞**: openai
- **–ú–æ–¥–µ–ª—å**: gpt-5 (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)
- **–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏**:
  - –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∫–∞—Å—Ç–æ–º–Ω—ã—Ö endpoints
  - JSON mode –¥–ª—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤
  - –¢–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞: 0.3 –¥–ª—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏

---

## üíª –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

### Backend
- **Python 3.11+**: –û—Å–Ω–æ–≤–Ω–æ–π —è–∑—ã–∫
- **Pandas**: –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö
- **NumPy**: –ß–∏—Å–ª–µ–Ω–Ω—ã–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è
- **Scikit-learn**: Machine Learning
- **SciPy**: –°—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑

### Frontend
- **Streamlit**: Web –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
- **Plotly**: –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è

### API –∫–ª–∏–µ–Ω—Ç—ã
- **yfinance**: Yahoo Finance –¥–∞–Ω–Ω—ã–µ
- **Telethon**: Telegram API
- **OpenAI**: LLM –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è

### –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞
- **UV**: –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏
- **Virtualenv**: –ò–∑–æ–ª—è—Ü–∏—è –æ–∫—Ä—É–∂–µ–Ω–∏—è

---

## üì® Telegram-–∫–æ–Ω–≤–µ–π–µ—Ä: –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –∏ –∑–∞–ø—É—Å–∫

1. **–ü–æ–ª—É—á–∏—Ç–µ Telegram API ID/Hash**: –Ω–∞ [my.telegram.org/apps](https://my.telegram.org/apps) —Å–æ–∑–¥–∞–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç–µ `api_id`, `api_hash` –∏ —Ç–µ–ª–µ—Ñ–æ–Ω –∞–∫–∫–∞—É–Ω—Ç–∞.
2. **–û–±–Ω–æ–≤–∏—Ç–µ –∫–æ–Ω—Ñ–∏–≥–∏**:
   - `config/channels.yml` ‚Äî —Å–ø–∏—Å–æ–∫ –ø—É–±–ª–∏—á–Ω—ã—Ö `username` –∏ –Ω–∞–∑–≤–∞–Ω–∏–π –∫–∞–Ω–∞–ª–æ–≤; –ø–æ–ª–µ `enabled` —É–ø—Ä–∞–≤–ª—è–µ—Ç –ø–∞—Ä—Å–∏–Ω–≥–æ–º.
   - `config/keywords.yml` (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) ‚Äî –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞/—Ä–µ–≥—É–ª—è—Ä–∫–∏ –¥–ª—è —Ç–µ–∫—Å—Ç–æ–≤–æ–π —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏.
3. **–ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫** —Å–æ—Ö—Ä–∞–Ω–∏—Ç user-—Å–µ—Å—Å–∏—é –≤ `data/telegram/stock_forecasting_session.session`. –ü—Ä–∏ –ø–µ—Ä–≤–æ–º –≤—Ö–æ–¥–µ Telethon –∑–∞–ø—Ä–æ—Å–∏—Ç –∫–æ–¥ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –≤ –∫–æ–Ω—Å–æ–ª–∏.
4. **CLI**: 
   ```bash
   python -m modules.telegram_parser \
     --channels config/channels.yml \
     --days-back 7 \
     --symbols SBER,GAZP,AAPL \
     --api-id $TELEGRAM_API_ID \
     --api-hash $TELEGRAM_API_HASH \
     --phone $TELEGRAM_PHONE
   ```
5. **–ò–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–æ—Å—Ç—å –∏ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ**:
   - `data/telegram/state.json` ‚Äî watermark `message_id` –ø–æ –∫–∞–Ω–∞–ª–∞–º.
   - `data/telegram/raw/{YYYY-MM-DD}.parquet` + `data/telegram/latest.parquet` ‚Äî —Å—ã—Ä—ã–µ –∏ –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è —Å –∫–æ–ª–æ–Ω–∫–∞–º–∏ `date_utc`, `channel_username`, `tickers`, `links`, `msg_hash`.
6. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –≤ Streamlit**: –≤–∫–ª–∞–¥–∫–∞ ¬´–ù–∞—Å—Ç—Ä–æ–µ–Ω–∏—è –Ω–æ–≤–æ—Å—Ç–µ–π¬ª –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `run_telegram_parser(...)` –∏ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç –ø—Ä–æ–≥—Ä–µ—Å—Å, —Å–≤–æ–¥–∫—É –∏ —ç–∫—Å–ø–æ—Ä—Ç –≤ LLM-–∫–æ–Ω–≤–µ–π–µ—Ä.

---

## üöÄ –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –∑–∞–ø—É—Å–∫—É

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
```bash
# –°–æ–∑–¥–∞–Ω–∏–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è
python -m venv .venv

# –ê–∫—Ç–∏–≤–∞—Ü–∏—è –æ–∫—Ä—É–∂–µ–Ω–∏—è
source .venv/bin/activate  # Linux/Mac
# –∏–ª–∏
.venv\Scripts\activate  # Windows

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
pip install -r requirements.txt
# –∏–ª–∏ —á–µ—Ä–µ–∑ uv
uv pip install -r pyproject.toml
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è
```bash
# –°–æ–∑–¥–∞–π—Ç–µ .env —Ñ–∞–π–ª
cat > .env << EOF
OPENAI_API_KEY=your_key
TELEGRAM_API_ID=your_id
TELEGRAM_API_HASH=your_hash
TELEGRAM_PHONE=your_phone
EOF

# –≠–∫—Å–ø–æ—Ä—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
export $(cat .env | xargs)
```

### 3. –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
```bash
# –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –∑–∞–ø—É—Å–∫
streamlit run app.py

# –° –∫–∞—Å—Ç–æ–º–Ω—ã–º –ø–æ—Ä—Ç–æ–º
streamlit run app.py --server.port 8501

# Headless —Ä–µ–∂–∏–º (–¥–ª—è —Å–µ—Ä–≤–µ—Ä–∞)
streamlit run app.py --server.headless true
```

### 4. –ü–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫
1. –û—Ç–∫—Ä–æ–π—Ç–µ http://localhost:8501
2. –í–≤–µ–¥–∏—Ç–µ API –∫–ª—é—á–∏ –≤ sidebar
3. –í—ã–±–µ—Ä–∏—Ç–µ –∞–∫—Ü–∏–∏ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞
4. –ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ Telegram –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

---

## ‚ö†Ô∏è –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
1. **RandomForest –ø—Ä–æ–≥–Ω–æ–∑**: –£–ø—Ä–æ—â–µ–Ω–Ω–∞—è —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–∞—è –º–æ–¥–µ–ª—å, –º–æ–∂–µ—Ç –¥—Ä–µ–π—Ñ–æ–≤–∞—Ç—å –Ω–∞ –¥–ª–∏–Ω–Ω—ã—Ö –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞—Ö
2. **MOEX API**: –ù–µ—Ç –∑–∞—â–∏—Ç—ã –æ—Ç rate limiting, –≤–æ–∑–º–æ–∂–Ω—ã —Å–±–æ–∏ –ø—Ä–∏ —á–∞—Å—Ç—ã—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö
3. **Telegram –ø–∞—Ä—Å–µ—Ä**: –¢—Ä–µ–±—É–µ—Ç –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—É—é –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é, –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç 2FA –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
4. **–°–æ—Å—Ç–æ—è–Ω–∏–µ —Å–µ—Å—Å–∏–∏**: –í—Å–µ –¥–∞–Ω–Ω—ã–µ —Å–±—Ä–∞—Å—ã–≤–∞—é—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–µ Streamlit

### –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
1. **–ù–µ—Ç –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏**: –î–∞–Ω–Ω—ã–µ –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –º–µ–∂–¥—É —Å–µ—Å—Å–∏—è–º–∏
2. **LLM —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ**: –ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç—Å—è JSON —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞, –Ω–µ—Ç retry –ª–æ–≥–∏–∫–∏
3. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**: –ë–∞–∑–æ–≤–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞, –º–æ–∂–µ—Ç —Ç—Ä–µ–±–æ–≤–∞—Ç—å —É–ª—É—á—à–µ–Ω–∏—è
4. **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å**: –û–¥–Ω–æ–ø–æ—Ç–æ—á–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ, –Ω–µ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–æ –¥–ª—è –±–æ–ª—å—à–∏—Ö –æ–±—ä–µ–º–æ–≤

### –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö
1. **Yahoo Finance**: –†–æ—Å—Å–∏–π—Å–∫–∏–µ –∞–∫—Ü–∏–∏ –º–æ–≥—É—Ç –±—ã—Ç—å –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã –∏–∑-–∑–∞ —Å–∞–Ω–∫—Ü–∏–π
2. **MOEX**: –¢–æ–ª—å–∫–æ –ø—É–±–ª–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ, –∑–∞–¥–µ—Ä–∂–∫–∞ 15 –º–∏–Ω—É—Ç
3. **Telegram**: –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å–æ–æ–±—â–µ–Ω–∏–π –∏ –∫–∞–Ω–∞–ª–æ–≤
4. **LLM**: –ó–∞–≤–∏—Å–∏—Ç –æ—Ç –∫–∞—á–µ—Å—Ç–≤–∞ –º–æ–¥–µ–ª–∏ –∏ –ø—Ä–æ–º–ø—Ç–æ–≤

---

## üìä –ú–µ—Ç—Ä–∏–∫–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### –¢–∏–ø–∏—á–Ω–æ–µ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∞–∫—Ü–∏–π: 2-5 —Å–µ–∫ –Ω–∞ —Å–∏–º–≤–æ–ª
- –ü–∞—Ä—Å–∏–Ω–≥ Telegram: 5-10 —Å–µ–∫ –Ω–∞ –∫–∞–Ω–∞–ª
- LLM –∞–Ω–∞–ª–∏–∑: 1-2 —Å–µ–∫ –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ
- –û–±—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–∏: 5-15 —Å–µ–∫
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø—Ä–æ–≥–Ω–æ–∑–∞: 2-5 —Å–µ–∫

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Ä–µ—Å—É—Ä—Å–∞–º
- RAM: –ú–∏–Ω–∏–º—É–º 2GB, —Ä–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ 4GB
- CPU: 2+ —è–¥—Ä–∞ –¥–ª—è –∫–æ–º—Ñ–æ—Ä—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã
- –î–∏—Å–∫: 500MB –¥–ª—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
- –°–µ—Ç—å: –°—Ç–∞–±–∏–ª—å–Ω–æ–µ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ

---

## üîç –û—Ç–ª–∞–¥–∫–∞ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

### –í–∫–ª—é—á–µ–Ω–∏–µ debug —Ä–µ–∂–∏–º–∞
```python
# –í app.py
import streamlit as st
st.set_option('deprecation.showPyplotGlobalUse', False)
st.set_option('logger.level', 'debug')
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞
```bash
python -m compileall app.py modules
```

### –¢–∏–ø–∏—á–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è
1. **"API key not found"**: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
2. **"No data for symbol"**: –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –º–µ–∂–¥—É–Ω–∞—Ä–æ–¥–Ω—ã–µ —Å–∏–º–≤–æ–ª—ã
3. **"Telegram auth failed"**: –£–¥–∞–ª–∏—Ç–µ session —Ñ–∞–π–ª –∏ –ø–µ—Ä–µ–∞–≤—Ç–æ—Ä–∏–∑—É–π—Ç–µ—Å—å
4. **"Model training failed"**: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –Ω–∞–ª–∏—á–∏–µ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

---

## üìù TODO –∏ –ø–ª–∞–Ω—ã —Ä–∞–∑–≤–∏—Ç–∏—è

### –ö—Ä–∞—Ç–∫–æ—Å—Ä–æ—á–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è
- [ ] –î–æ–±–∞–≤–∏—Ç—å unit —Ç–µ—Å—Ç—ã
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å retry –ª–æ–≥–∏–∫—É –¥–ª—è API
- [ ] –î–æ–±–∞–≤–∏—Ç—å –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
- [ ] –£–ª—É—á—à–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç–∫—É –æ—à–∏–±–æ–∫

### –î–æ–ª–≥–æ—Å—Ä–æ—á–Ω—ã–µ –ø–ª–∞–Ω—ã
- [ ] –ú–∏–≥—Ä–∞—Ü–∏—è –Ω–∞ async –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É
- [ ] –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –¥—Ä—É–≥–∏—Ö ML –º–æ–¥–µ–ª–µ–π (LSTM, XGBoost)
- [ ] –†–µ–∞–ª–∏–∑–∞—Ü–∏—è backtesting
- [ ] –î–æ–±–∞–≤–ª–µ–Ω–∏–µ real-time –¥–∞–Ω–Ω—ã—Ö
- [ ] –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –±—Ä–æ–∫–µ—Ä—Å–∫–∏–º–∏ API
- [ ] –ú–æ–±–∏–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

---

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è –∏ –∞–≤—Ç–æ—Ä—ã

**–¢–∏–ø –ø—Ä–æ–µ–∫—Ç–∞**: –£—á–µ–±–Ω—ã–π –ø—Ä–æ–µ–∫—Ç
**–°—Ç–∞—Ç—É—Å**: –í –∞–∫—Ç–∏–≤–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ
**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ**: 2025-09-29

---

*–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö –≤ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ –ø—Ä–æ–µ–∫—Ç–∞*
